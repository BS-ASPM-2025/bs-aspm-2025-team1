{% extends "base.html" %}

{% block title %}  {% endblock %}

{% block extra_css %}
<style>
  main {
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 2.5rem 1rem;
  }

  .form-card {
    width: 100%;
    max-width: 600px;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.08), 0 4px 6px -2px rgba(0,0,0,0.05);
    padding: 2rem;
  }

  h1 {
    margin: 0;
    font-size: 1.6rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }

  .subtitle {
    margin-top: 0.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
  }

  .success-alert {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
    padding: 0.85rem 1rem;
    border-radius: 0.75rem;
    margin-bottom: 1.25rem;
    font-weight: 600;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-color);
  }

  input[type="text"],
  input[type="number"],
  select,
  textarea {
    width: 100%;
    box-sizing: border-box;
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 0.85rem 0.95rem;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: white;
  }

  textarea {
    min-height: 140px;
    resize: vertical;
    line-height: 1.4;
  }

  input:focus, select:focus, textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(79,70,229,0.12);
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 160px;
    gap: 1rem;
    align-items: end;
  }

  .weight-input {
    text-align: center;
    font-weight: 700;
  }

  #weightsInfo {
    padding: 0.75rem 0.9rem;
    border-radius: 0.75rem;
    background: rgba(0,0,0,0.03);
    border: 1px dashed var(--border-color);
  }

  #submitBtn {
    margin-top: 0.25rem;
    width: 100%;
    border: none;
    border-radius: 0.75rem;
    padding: 0.95rem 1rem;
    background: var(--primary-color);
    color: white;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.05s, background-color 0.2s, opacity 0.2s;
  }

  #submitBtn:hover {
    background: var(--primary-hover);
  }

  #submitBtn:active {
    transform: translateY(1px);
  }

  #submitBtn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
  }

  /* Mobile */
  @media (max-width: 640px) {
    .form-card { padding: 1.25rem; }
    .row { grid-template-columns: 1fr; }
  }

  .page-stack{
  width: 100%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

 .title{
   margin: 0.25rem 0 0;
   font-size: 1.25rem;
   font-weight: 800;
 }

 .weights-info{
   margin-top: 0.5rem;
   font-weight: 600;
 }

 .upload-card{
   padding: 1.5rem;
 }

 .btn-upload{
   display: inline-flex;
   align-items: center;
   justify-content: center;
   width: 100%;
   margin-top: 0.5rem;
   text-decoration: none;
   border-radius: 0.75rem;
   padding: 0.95rem 1rem;
   background: var(--primary-color);
   color: white;
   font-weight: 800;
 }
 .btn-upload:hover{
   background: var(--primary-hover);
 }


</style>
{% endblock %}


{% block content %}

<main>
  <div class="page-stack">

    <div class="form-card">
      <h1>{{ company }}</h1>
      <h2 class="title">Post a Job Opportunity</h2>
      <p class="subtitle">Fill in the details below to find the perfect candidate.</p>

      {% if success %}
        <div class="success-alert">✅ Job posted successfully!</div>
      {% endif %}

      <form id="postJobForm" action="/post_job" method="post">
        <div class="form-group">
          <label for="title">Job Title</label>
          <input type="text" id="title" name="title" placeholder="e.g. Senior Software Engineer" required>
        </div>

        <div class="row">
          <div class="form-group">
            <label for="degree">Minimum Degree</label>
            <select id="degree" name="degree">
              <option value="Associate">Associate Degree</option>
              <option value="Bachelor" selected>Bachelor's Degree</option>
              <option value="Master">Master's Degree</option>
              <option value="PhD">PhD</option>
              <option value="None">No Degree Required</option>
            </select>
          </div>
          <div>
            <label>Weight</label>
            <input type="number" class="weight-input" name="degree_weight" min="0" max="50" value="40">
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label for="experience">Years of Experience</label>
            <input type="number" id="experience" name="experience" min="0" max="60" placeholder="e.g. 3" required>
          </div>
          <div>
            <label>Weight</label>
            <input type="number" class="weight-input" name="experience_weight" min="0" max="60" value="30">
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label for="skills">Required Skills (comma separated)</label>
            <input type="text" id="skills" name="required_skills" placeholder="e.g. Python, FastAPI, React, SQL" required>
          </div>
          <div>
            <label>Weight</label>
            <input type="number" class="weight-input" name="skills_weight" min="0" max="50" value="30">
          </div>
        </div>

        <div class="form-group">
          <label for="job_text">Job Description</label>
          <textarea id="job_text" name="job_text"
            placeholder="Detailed description of the role and responsibilities..." required></textarea>
        </div>

        <p id="weightsInfo" class="weights-info"></p>
        <button id="submitBtn" type="submit">Post Job</button>
      </form>
    </div>

    <div class="form-card upload-card">
      <h2 class="title">Manage Job Opportunities</h2>
      <p class="subtitle">View all of your company open positions</p>
      <a class="btn-upload" href="/jobs_list">Browse All Jobs</a>
    </div>

  </div>
</main>

<script>
  // Fade success alert after 3 seconds
  setTimeout(() => {
    const el = document.querySelector('.success-alert');
    if (el) el.remove();
  }, 3000);

  // ===== Weights: must sum exactly to 100 =====
  const REQUIRED_SUM = 100;
  const DECIMALS = 1;

  const form = document.getElementById('postJobForm');
  const inputs = document.querySelectorAll('.weight-input');
  const info = document.getElementById('weightsInfo');
  const submitBtn = document.getElementById('submitBtn');

  const roundTo = (n, decimals) => {
    const p = Math.pow(10, decimals);
    return Math.round(n * p) / p;
  };

  const formatTo = (n, decimals) => roundTo(n, decimals).toFixed(decimals);

  const parse = (v) => {
    const x = parseFloat(v);
    return Number.isFinite(x) ? x : 0;
  };

  const updateWeightsUI = () => {
    let sum = 0;
    inputs.forEach(i => sum += parse(i.value));
    sum = roundTo(sum, DECIMALS);

    const ok = (sum === REQUIRED_SUM);

    if (info) {
      info.textContent = ok
        ? `✓ Weights total = ${formatTo(sum, DECIMALS)} / ${REQUIRED_SUM}`
        : `Weights total: ${formatTo(sum, DECIMALS)} / ${REQUIRED_SUM} (must equal ${REQUIRED_SUM})`;
      info.style.color = ok ? '#166534' : '#b91c1c';
    }

    if (submitBtn) submitBtn.disabled = !ok;
  };

  inputs.forEach(input => {
    input.addEventListener('input', () => {
      const min = input.min !== '' ? parseFloat(input.min) : -Infinity;
      const max = input.max !== '' ? parseFloat(input.max) : Infinity;
      let v = parse(input.value);

      if (v < min) v = min;
      if (v > max) v = max;

      input.value = v;
      updateWeightsUI();
    });

    input.addEventListener('blur', () => {
      const v = parse(input.value);
      input.value = formatTo(v, DECIMALS);
      updateWeightsUI();
    });
  });

  if (form) {
    form.addEventListener('submit', (e) => {
      let sum = 0;
      inputs.forEach(i => sum += parse(i.value));
      sum = roundTo(sum, DECIMALS);

      if (sum !== REQUIRED_SUM) {
        e.preventDefault();
        updateWeightsUI();
        alert(`Weights must sum exactly to ${REQUIRED_SUM}. Current total: ${formatTo(sum, DECIMALS)}.`);
      }
    });
  }

  updateWeightsUI();
</script>

{% endblock %}
